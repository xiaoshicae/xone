# 提交代码

查看当前更改并生成规范的提交信息。

使用方法: /project:commit

---

请执行以下步骤：

## 1. 查看当前更改

运行 `git status` 和 `git diff` 查看当前更改，分析变更涉及的模块。

## 2. 运行单元测试

运行所有单元测试，确保全部通过：

```bash
go test -gcflags="all=-N -l" ./... -v
```

如果测试失败，停止提交流程并提示用户修复。

## 3. 检查增量代码覆盖率

对变更的模块运行覆盖率检查：

```bash
# 获取变更的模块目录
git diff --name-only | grep '\.go$' | xargs -I {} dirname {} | sort -u

# 对每个变更模块运行覆盖率
go test -gcflags="all=-N -l" -coverprofile=coverage.out ./<module>/...
go tool cover -func=coverage.out
```

要求：增量代码覆盖率需达到 **60%** 以上。如果覆盖率不足，提示用户补充测试。

## 4. 分析提交类型

根据更改内容确定提交类型：

| 类型 | 说明 | 版本号变更 |
|------|------|-----------|
| `feat` | 新功能 | 中版本号 +1 (如 v1.1.5 → v1.2.0) |
| `fix` | Bug 修复 | 最小版本号 +1 (如 v1.1.5 → v1.1.6) |
| `docs` | 文档更新 | 不变更版本号 |
| `refactor` | 代码重构 | 最小版本号 +1 |
| `perf` | 性能优化 | 最小版本号 +1 |
| `test` | 测试相关 | 不变更版本号 |
| `chore` | 构建/工具相关 | 不变更版本号 |

**版本号规则：**
- `fix`/`refactor`/`perf`: 最小版本号 (patch) +1
- `feat`: 中版本号 (minor) +1，最小版本号归零
- 大版本号 (major) 由用户手动控制，不自动变更

## 5. 更新 README.md

根据提交类型更新 README.md：

1. 在"更新日志"部分顶部添加新版本记录，格式：
   ```
   - **vX.Y.Z** (YYYY-MM-DD) - <type>: <简短描述>
   ```

2. 如果涉及配置变更，同步更新配置示例部分

## 6. 生成提交信息

生成符合以下格式的提交信息：

```
<type>: <简短描述>

<详细说明（可选）>
```

## 7. 执行提交

使用 HEREDOC 格式提交：

```bash
git add -A
git commit -m "$(cat <<'EOF'
提交信息
EOF
)"
```

## 8. 确认提交状态

提交后运行 `git status` 确认状态。

---

## 提交前检查清单

- [ ] 单元测试全部通过
- [ ] 增量代码覆盖率 >= 60%
- [ ] README.md 更新日志已添加
- [ ] 版本号已正确更新（feat/fix/refactor/perf）
- [ ] 提交信息格式规范